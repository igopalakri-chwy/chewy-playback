{% extends "base.html" %}

{% block title %}Pet Experience - Customer {{ customer_id }} - Chewy Playback{% endblock %}

{% block content %}
<script>
// Dynamic styling based on data content
function getDynamicStyles(data) {
    const styles = {};
    
    // Food consumption styling
    const foodLbs = data.food_fun_fact ? parseFloat(data.food_fun_fact.total_food_lbs) || 0 : 0;
    if (foodLbs > 100) {
        styles.foodIcon = 'color: white; font-size: 70px;';
        styles.foodTitle = 'color: white; font-size: 28px;';
    } else if (foodLbs > 50) {
        styles.foodIcon = 'color: white; font-size: 60px;';
        styles.foodTitle = 'color: white; font-size: 24px;';
    } else {
        styles.foodIcon = 'color: white; font-size: 50px;';
        styles.foodTitle = 'color: white; font-size: 20px;';
    }
    
    return styles;
}

// Apply dynamic styles when page loads
document.addEventListener('DOMContentLoaded', function() {
    const customerData = JSON.parse('{{ customer_data | tojson | safe }}');
    const styles = getDynamicStyles(customerData);
    
    // Apply styles to elements
    const foodIcon = document.querySelector('.funfact-icon i');
    if (foodIcon) foodIcon.style.cssText = styles.foodIcon;
    
    const foodTitle = document.querySelector('.funfact-title');
    if (foodTitle) foodTitle.style.cssText = styles.foodTitle;
    
    // Animate the food number with counting effect
    animateFoodNumber();
});

function animateFoodNumber() {
    const numberElement = document.getElementById('food-number');
    if (!numberElement) return;
    
    const finalNumber = parseInt(numberElement.textContent);
    let currentNumber = 0;
    const duration = 2000; // 2 seconds
    const steps = 60;
    const increment = finalNumber / steps;
    const stepDuration = duration / steps;
    
    const timer = setInterval(() => {
        currentNumber += increment;
        if (currentNumber >= finalNumber) {
            currentNumber = finalNumber;
            clearInterval(timer);
        }
        numberElement.textContent = Math.floor(currentNumber);
    }, stepDuration);
}
</script>

<style>
/* Base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #002266 100%);
    min-height: 100vh;
    overflow-x: hidden;
}

.container {
    width: 100%;
    height: 100vh;
    max-width: 100%;
    margin: 0;
    padding: 0;
    overflow-y: auto;
    overflow-x: hidden;
    background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #002266 100%);
    position: relative;
}

/* Slide styles */
.slide {
    display: none;
    min-height: 100vh;
    padding: 0;
    position: relative;
    margin: 0;
    width: 100%;
}

.slide.active {
    display: block;
}

.slide-content {
    background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #002266 100%);
    color: white;
    padding: 20px 15px 60px 15px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    text-align: center;
    border-radius: 0;
    box-shadow: none;
    overflow-y: auto;
    margin: 0;
    box-sizing: border-box;
    position: relative;
}

/* Special handling for breed slide content */
.breed-slide .slide-content {
    overflow-y: auto;
    height: 100%;
    padding: 20px 15px 120px 15px;
    position: relative;
    z-index: 1;
}

/* Special handling for letter slide content */
.letter-slide .slide-content {
    overflow: hidden;
    height: 100vh;
    padding: 20px 15px;
    position: relative;
    z-index: 1;
}

/* Ensure all breed slide elements can scroll */
.breed-slide * {
    box-sizing: border-box;
}

/* Increase bottom spacing for breed container */
.breed-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 20px 20px 40px 20px;
    min-height: 100%;
    display: flex;
    flex-direction: column;
    gap: 20px;
    position: relative;
    z-index: 2;
}



/* Slide counter */
.slide-counter {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 102, 204, 0.9);
    color: white;
    padding: 6px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    backdrop-filter: blur(10px);
    z-index: 10;
}

/* Food Fun Fact Slide */

.food-consumption-title {
    color: white;
    font-size: 48px;
    font-weight: 700;
    margin: 20px 0 10px 0;
    font-family: 'Poppins', sans-serif;
}

.food-consumption-subtitle {
    color: white;
    font-size: 18px;
    font-weight: 400;
    margin-bottom: 30px;
    font-family: 'Poppins', sans-serif;
    opacity: 0.9;
}

.funfact-messages {
    text-align: left;
    max-width: 90%;
    margin: 0 auto;
}

.funfact-message {
    color: white;
    font-size: 20px;
    line-height: 1.6;
    font-family: 'Poppins', sans-serif;
    font-weight: 400;
    margin-bottom: 15px;
    padding: 15px;
    background: rgba(0, 102, 204, 0.1);
    border-radius: 10px;
    border-left: 4px solid rgba(255, 255, 255, 0.3);
}

/* Highlight number + item format in fun facts */
.funfact-message .highlight-number {
    font-weight: 700;
    color: white;
}



/* Spotify Wrapped Style */
.spotify-wrapped-container {
    text-align: center;
    padding: 40px 20px;
    max-width: 100%;
    margin: 0 auto;
    min-height: auto;
    overflow: visible;
}

.wrapped-text-line {
    color: white;
    font-size: 18px;
    font-weight: 400;
    font-family: 'Poppins', sans-serif;
    margin-bottom: 8px;
    opacity: 0.9;
    animation: fadeInUp 0.8s ease-out;
}

.wrapped-number {
    color: white;
    font-size: 64px;
    font-weight: 800;
    font-family: 'Poppins', sans-serif;
    margin: 20px 0;
    animation: numberPop 1.2s ease-out;
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    line-height: 1;
    overflow: visible;
    display: block;
    width: 100%;
}

.wrapped-highlight {
    color: white;
    font-size: 24px;
    font-weight: 700;
    font-family: 'Poppins', sans-serif;
    margin-bottom: 12px;
    animation: slideInRight 0.8s ease-out;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes numberPop {
    0% {
        opacity: 0;
        transform: scale(0.5) translateY(50px);
    }
    50% {
        transform: scale(1.1) translateY(-10px);
    }
    100% {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translate(-50%, -40%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}



.funfact-icon {
    margin-bottom: 15px;
}

.funfact-content {
    background: rgba(0, 102, 204, 0.15);
    padding: 20px 15px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    margin: 10px 0;
    border: 1px solid rgba(0, 102, 204, 0.3);
}

.funfact-title {
    color: white;
    font-size: 24px;
    font-weight: 600;
    margin: 20px 0 15px 0;
    font-family: 'Poppins', sans-serif;
}

.funfact-highlight {
    background: linear-gradient(135deg, #0066cc, #004499);
    padding: 20px;
    border-radius: 12px;
    margin-top: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Slide title styling */
.slide-title {
    color: white !important;
    font-size: 28px;
    font-weight: 700;
    margin: 30px 0 20px 0;
    text-align: center;
    font-family: 'Poppins', sans-serif;
    animation: none !important;
    transition: none !important;
    transform: none !important;
    background: none !important;
    background-image: none !important;
    -webkit-background-clip: initial !important;
    background-clip: initial !important;
    -webkit-text-fill-color: white !important;
    text-shadow: none !important;
    filter: none !important;
}

.funfact-text {
    color: white;
    font-size: 16px;
    line-height: 1.6;
    font-family: 'Poppins', sans-serif;
    font-weight: 400;
}

/* Busiest Month Slide */
.busiest-container {
    max-width: 800px;
    margin: 0 auto;
}

.busiest-icon {
    margin-bottom: 30px;
}

.busiest-content {
    background: rgba(255,255,255,0.1);
    padding: 40px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
}

.busiest-title {
    color: white;
    font-size: 32px;
    margin-bottom: 30px;
}

.busiest-highlight {
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    padding: 25px;
    border-radius: 15px;
    margin-top: 20px;
}

.busiest-text {
    color: white;
    font-size: 18px;
    line-height: 1.6;
}

/* Portrait Slide */
.portrait-container {
    max-width: 800px;
    margin: 0 auto;
}

.portrait-image {
    max-width: 100%;
    height: auto;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.3);
    margin-bottom: 30px;
}

/* Letter Slide */
.letter-container {
    max-width: 700px;
    margin: 0 auto;
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    display: block;
    color: white;
    font-size: 14px;
    line-height: 1.4;
    text-align: left;
    white-space: pre-line;
    font-family: 'Poppins', sans-serif;
    font-weight: 400;
    width: 100%;
    box-sizing: border-box;
    border: 1px solid rgba(255,255,255,0.2);
}

.letter-container p {
    margin: 0 0 8px 0;
    padding: 0;
}

.letter-container p:last-child {
    margin-bottom: 0;
}



/* Badge Slide */
.badge-container {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
}

.badge-image {
    max-width: 300px;
    height: auto;
    margin-bottom: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

.badge-title {
    color: white;
    font-size: 24px;
    margin: 20px 0 15px 0;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
}

.badge-description {
    color: white;
    font-size: 16px;
    line-height: 1.6;
    background: rgba(0, 102, 204, 0.15);
    padding: 20px 15px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    font-family: 'Poppins', sans-serif;
    font-weight: 400;
    border: 1px solid rgba(0, 102, 204, 0.3);
    margin: 10px 0;
}

/* Breed Slide */
.breed-container {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
}

.breed-title {
    color: white;
    font-size: 32px;
    margin-bottom: 30px;
}

.breed-content {
    background: rgba(255,255,255,0.1);
    padding: 40px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
}

.breed-name {
    color: white;
    font-size: 36px;
    font-weight: bold;
    margin-bottom: 20px;
}

.breed-description {
    color: white;
    font-size: 18px;
    line-height: 1.6;
}

/* Breed Pet Highlight */
.breed-pet-highlight {
    text-align: center;
    margin-bottom: 25px;
    padding: 20px;
    background: linear-gradient(135deg, rgba(74, 144, 226, 0.3), rgba(42, 82, 152, 0.3));
    border-radius: 20px;
    border: 2px solid rgba(74, 144, 226, 0.4);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 25px rgba(74, 144, 226, 0.2);
    animation: fadeInUp 0.8s ease-out;
}

.breed-highlight-text {
    color: white;
    font-size: 20px;
    line-height: 1.5;
    margin: 0;
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
}

.breed-highlight-text strong {
    color: white;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Breed Predictions - Simple List Style */
.breed-predictions-card {
    margin-bottom: 15px;
    animation: fadeInUp 0.8s ease-out;
}

/* Breed Grid Animation */
.breed-grid-animation {
    opacity: 0;
    transform: translateY(30px);
    animation: breedGridSlideIn 1s ease-out 0.2s forwards;
}

.breed-predictions-grid {
    margin-bottom: 0;
}

@keyframes breedGridSlideIn {
    0% {
        opacity: 0;
        transform: translateY(30px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

.breed-predictions-title {
    color: white;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 15px;
    text-align: center;
    font-family: 'Poppins', sans-serif;
}

.breed-predictions-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.breed-prediction-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.breed-prediction-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateX(5px);
}

.breed-prediction-info {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.breed-prediction-name {
    color: white;
    font-size: 18px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
}

.breed-prediction-percentage {
    color: rgba(255, 255, 255, 0.8);
    font-size: 16px;
    font-weight: 500;
}

.breed-prediction-check {
    display: flex;
    align-items: center;
    gap: 10px;
}

.breed-checkbox {
    width: 20px;
    height: 20px;
    accent-color: #4a90e2;
    cursor: pointer;
}

.breed-checkbox-label {
    color: white;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
}

/* Question Card - Simple Style */
.breed-question-card {
    margin-bottom: 25px;
    animation: fadeInUp 0.8s ease-out;
}

.breed-question-title {
    color: white;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 25px;
    text-align: center;
    font-family: 'Poppins', sans-serif;
}

/* Question Text Animation */
.question-text-animation {
    opacity: 0;
    transform: translateY(20px);
    animation: questionTextSlideIn 0.8s ease-out 1.5s forwards;
}

/* Question Options Animation */
.options-animation {
    opacity: 0;
    transform: translateY(20px);
    animation: optionsSlideIn 0.8s ease-out 2s forwards;
}

@keyframes questionTextSlideIn {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes optionsSlideIn {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

.breed-question-options {
    display: flex;
    justify-content: center;
    gap: 30px;
}

.breed-question-option {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 15px 25px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.breed-question-option:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.breed-question-option input[type="radio"] {
    width: 18px;
    height: 18px;
    accent-color: #4a90e2;
}

.breed-question-text {
    color: white;
    font-size: 16px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
}

/* Yes Response - Simple Style */
.breed-yes-response {
    margin-bottom: 25px;
    animation: fadeInUp 0.8s ease-out;
}

.breed-response-title {
    color: white;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 25px;
    text-align: center;
    font-family: 'Poppins', sans-serif;
}

.breed-correct-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.breed-correct-item {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.breed-correct-item:hover {
    background: rgba(255, 255, 255, 0.15);
}

.breed-correct-check {
    display: flex;
    align-items: center;
    gap: 10px;
}

.breed-correct-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.breed-correct-name {
    color: white;
    font-size: 18px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
}

.breed-correct-reason {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-style: italic;
}

/* No Response - Simple Style */
.breed-no-response {
    margin-bottom: 25px;
    animation: fadeInUp 0.8s ease-out;
}

.breed-profile-input-section {
    text-align: center;
}

.breed-profile-text {
    color: white;
    font-size: 16px;
    margin-bottom: 20px;
    font-family: 'Poppins', sans-serif;
}

.breed-profile-input {
    width: 100%;
    max-width: 400px;
    padding: 15px;
    border-radius: 10px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 16px;
    margin-bottom: 20px;
    font-family: 'Poppins', sans-serif;
}

.breed-profile-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

.breed-profile-input:focus {
    outline: none;
    border-color: #4a90e2;
    background: rgba(255, 255, 255, 0.15);
}

.breed-profile-submit-btn {
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
}

.breed-profile-submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
    background: linear-gradient(135deg, #5aa0f2, #3a62a8);
}



.breed-prediction-card .breed-name {
    color: white;
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
}

.breed-prediction-card .breed-percentage {
    color: white;
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 5px;
}

.breed-prediction-card .breed-pet-name {
    color: rgba(255,255,255,0.8);
    font-size: 16px;
    margin-bottom: 10px;
}

.breed-prediction-card .breed-click-hint {
    color: rgba(255,255,255,0.6);
    font-size: 12px;
    font-style: italic;
}

.breed-question-section {
    margin-top: 10px;
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
    border-radius: 25px;
    backdrop-filter: blur(15px);
    border: 2px solid rgba(255,255,255,0.2);
    animation: fadeInUp 1s ease-out 0.5s both;
}

.breed-question {
    color: white;
    font-size: 28px;
    margin-bottom: 25px;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.breed-answer-buttons {
    display: flex;
    justify-content: center;
    gap: 25px;
}

.breed-answer-btn {
    padding: 15px 35px;
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 18px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
    cursor: pointer;
    transition: all 0.4s ease;
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.3);
    border: 2px solid rgba(255,255,255,0.2);
}

.breed-answer-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 30px rgba(74, 144, 226, 0.5);
    background: linear-gradient(135deg, #5aa0f2, #3a62a8);
}

.breed-feedback-yes,
.breed-feedback-no {
    margin-top: 30px;
    text-align: center;
    padding: 30px;
    background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
    border-radius: 25px;
    backdrop-filter: blur(15px);
    border: 2px solid rgba(255,255,255,0.2);
    animation: fadeInUp 1s ease-out;
}

.breed-feedback-yes h4,
.breed-feedback-no h4 {
    color: white;
    font-size: 26px;
    margin-bottom: 25px;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.breed-checkboxes {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 25px;
    text-align: left;
}

.breed-checkbox-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
    border-radius: 15px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
}

.breed-checkbox-item:hover {
    background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
    transform: translateX(5px);
}

.breed-checkbox {
    width: 22px;
    height: 22px;
    accent-color: #4a90e2;
    cursor: pointer;
}

.breed-checkbox-item label {
    color: white;
    font-size: 16px;
    cursor: pointer;
    flex: 1;
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
}

.breed-feedback-text {
    color: rgba(255,255,255,0.9);
    font-size: 18px;
    line-height: 1.6;
    font-family: 'Poppins', sans-serif;
    font-weight: 400;
    margin-bottom: 25px;
}

.breed-profile-link {
    margin-top: 25px;
}

.breed-profile-btn {
    display: inline-block;
    padding: 15px 35px;
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    color: white;
    text-decoration: none;
    border-radius: 30px;
    font-size: 18px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
    transition: all 0.4s ease;
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.3);
    border: 2px solid rgba(255,255,255,0.2);
}

.breed-profile-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 30px rgba(74, 144, 226, 0.5);
    background: linear-gradient(135deg, #5aa0f2, #3a62a8);
}

/* Breed Flashcard Modal - Spotify Wrapped Style */
.breed-flashcard-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 1000;
    backdrop-filter: blur(15px);
    animation: fadeIn 0.3s ease-out;
}

.breed-flashcard-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 30px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 30px 60px rgba(0,0,0,0.5);
    border: 3px solid rgba(255,255,255,0.3);
    animation: slideInUp 0.4s ease-out;
    position: relative;
}

.breed-flashcard-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 30% 70%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
    border-radius: 30px;
    pointer-events: none;
}

.breed-flashcard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    position: relative;
    z-index: 2;
}

.breed-flashcard-header h3 {
    color: white;
    font-size: 32px;
    margin: 0;
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.breed-flashcard-close {
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    font-size: 22px;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
}

.breed-flashcard-close:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

.breed-flashcard-body {
    color: white;
    position: relative;
    z-index: 2;
}

.breed-flashcard-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 25px;
    padding: 20px;
    background: rgba(255,255,255,0.15);
    border-radius: 15px;
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.breed-flashcard-pet,
.breed-flashcard-confidence {
    font-size: 18px;
    color: rgba(255,255,255,0.95);
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
}

.breed-flashcard-description {
    font-size: 16px;
    line-height: 1.7;
    background: rgba(255,255,255,0.1);
    padding: 25px;
    border-radius: 20px;
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    font-family: 'Poppins', sans-serif;
}

/* Stats Slide */

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 30px;
    margin-bottom: 30px;
    width: 100%;
}

.stat-card {
    background: rgba(255,255,255,0.1);
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.stat-card:hover {
    background: rgba(255,255,255,0.15);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.stat-value {
    color: white;
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 10px;
}

/* Arrow Navigation */
.slide-arrow-nav {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.slide-arrow-nav:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 5px 15px rgba(255,255,255,0.2);
}

.slide-arrow-nav.prev {
    left: 20px;
}

.slide-arrow-nav.next {
    right: 20px;
}

.slide-arrow-nav i {
    color: white;
    font-size: 24px;
}

.slide-arrow-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.slide-arrow-nav:disabled:hover {
    transform: translateY(-50%);
    background: rgba(255,255,255,0.2);
    box-shadow: none;
}

.stat-label {
    color: white;
    font-size: 16px;
}

/* Social Media Slide */
.share-container {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
}

.share-title {
    color: white;
    font-size: 36px;
    margin-bottom: 30px;
}

.share-content {
    background: rgba(255,255,255,0.1);
    padding: 40px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
}

.share-text {
    color: white;
    font-size: 20px;
    line-height: 1.6;
    margin-bottom: 30px;
}

/* Enhanced Social Media Sharing */
.enhanced-share-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 15px;
}

.enhanced-share-content {
    background: rgba(255, 255, 255, 0.15);
    padding: 30px 25px;
    border-radius: 20px;
    backdrop-filter: blur(15px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
}

.enhanced-share-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(42, 82, 152, 0.1));
    pointer-events: none;
}

.enhanced-share-text {
    text-align: center;
    margin-bottom: 25px;
    position: relative;
    z-index: 1;
}

.enhanced-social-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 30px 0;
    position: relative;
    z-index: 1;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

.enhanced-social-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 18px 15px;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
    min-height: 90px;
}

.enhanced-social-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.enhanced-social-card:hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.4);
}

.enhanced-social-card:hover::before {
    opacity: 1;
}

.enhanced-social-icon {
    margin-bottom: 8px;
    position: relative;
    z-index: 1;
}

.enhanced-social-icon i {
    font-size: 28px;
    color: white;
    transition: all 0.3s ease;
}

.enhanced-social-label {
    color: white;
    font-size: 12px;
    font-weight: 600;
    text-align: center;
    position: relative;
    z-index: 1;
    font-family: 'Poppins', sans-serif;
}

/* Enhanced Social Media Brand Colors */
.enhanced-social-card.facebook:hover {
    background: linear-gradient(135deg, #1877f2, #0d6efd);
    border-color: #1877f2;
    box-shadow: 0 20px 40px rgba(24, 119, 242, 0.4);
}

.enhanced-social-card.instagram:hover {
    background: linear-gradient(135deg, #e4405f, #c13584);
    border-color: #e4405f;
    box-shadow: 0 20px 40px rgba(228, 64, 95, 0.4);
}

.enhanced-social-card.snapchat:hover {
    background: linear-gradient(135deg, #fffc00, #ffd700);
    border-color: #fffc00;
    box-shadow: 0 20px 40px rgba(255, 252, 0, 0.4);
}

.enhanced-social-card.snapchat:hover .enhanced-social-icon i,
.enhanced-social-card.snapchat:hover .enhanced-social-label {
    color: #333;
}

.enhanced-social-card.message:hover {
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    border-color: #4a90e2;
    box-shadow: 0 20px 40px rgba(74, 144, 226, 0.4);
}

.enhanced-share-cta {
    text-align: center;
    margin-top: 25px;
    position: relative;
    z-index: 1;
}

.enhanced-share-btn {
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    color: white;
    border: none;
    padding: 15px 32px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 700;
    font-family: 'Poppins', sans-serif;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
}

.enhanced-share-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.enhanced-share-btn:hover::before {
    left: 100%;
}

.enhanced-share-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 15px 35px rgba(74, 144, 226, 0.6);
    background: linear-gradient(135deg, #5aa0f2, #3a62a8);
}

.enhanced-share-icon {
    font-size: 18px;
}

.enhanced-share-text {
    font-weight: 700;
}

/* Legacy Social Media Icons (keeping for compatibility) */
.social-media-icons {
    display: flex;
    justify-content: center;
    gap: 25px;
    margin: 40px 0;
    flex-wrap: wrap;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.social-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 20px;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 100px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255,255,255,0.2);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.social-icon:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 15px 35px rgba(0,0,0,0.3);
    border-color: rgba(255,255,255,0.4);
}

.social-icon i {
    font-size: 32px;
    color: white;
}

.social-label {
    color: white;
    font-size: 12px;
    font-weight: bold;
    text-align: center;
}

/* Social Media Brand Colors */
.social-icon.facebook:hover {
    background: linear-gradient(135deg, #1877f2, #0d6efd);
    border-color: #1877f2;
}

.social-icon.snapchat:hover {
    background: linear-gradient(135deg, #fffc00, #ffd700);
    border-color: #fffc00;
}

.social-icon.snapchat:hover i,
.social-icon.snapchat:hover .social-label {
    color: white;
}

.social-icon.instagram:hover {
    background: linear-gradient(135deg, #e4405f, #c13584);
    border-color: #e4405f;
}

.social-icon.whatsapp:hover {
    background: linear-gradient(135deg, #25d366, #128c7e);
    border-color: #25d366;
}

.social-icon.message:hover {
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    border-color: #4a90e2;
}

/* Share CTA Button */
.share-cta-button {
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0 auto;
}

.share-cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
    background: linear-gradient(135deg, #5aa0f2, #3a62a8);
}

.share-btn-icon {
    font-size: 18px;
}

.share-btn-text {
    font-size: 16px;
    font-weight: 600;
}

/* Share Container Enhancements */
.share-container {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
    padding: 20px;
}

.share-content {
    background: rgba(255,255,255,0.1);
    padding: 40px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.share-text {
    color: white;
    font-size: 18px;
    line-height: 1.6;
    margin-bottom: 30px;
    font-family: 'Poppins', sans-serif;
}

.share-text p {
    margin-bottom: 10px;
    font-weight: 400;
}

.share-cta-section {
    margin-top: 30px;
    text-align: center;
}

/* Unknowns Slide */
.unknowns-container {
    max-width: 800px;
    margin: 0 auto;
}

.unknowns-title {
    color: white;
    font-size: 32px;
    margin-bottom: 30px;
    text-align: center;
}

.unknowns-content {
    background: rgba(255,255,255,0.1);
    padding: 40px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    text-align: left;
}

.unknowns-text {
    color: white;
    font-size: 16px;
    line-height: 1.6;
    white-space: pre-wrap;
}

/* Unknowns Enhanced Styles */
.unknowns-summary {
    text-align: center;
    margin-bottom: 30px;
}

.unknowns-summary-text {
    color: white;
    font-size: 18px;
    line-height: 1.6;
    font-family: 'Poppins', sans-serif;
    font-weight: 400;
    margin-bottom: 15px;
}

.unknowns-pets-grid {
    display: flex;
    flex-direction: column;
    gap: 25px;
    margin-bottom: 30px;
}

.unknowns-pet-card {
    background: rgba(255,255,255,0.1);
    padding: 25px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.unknowns-pet-card:hover {
    background: rgba(255,255,255,0.15);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.unknowns-pet-name {
    color: white;
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
}

.unknowns-pet-name .emoji {
    margin-right: 10px;
}

.unknowns-fields-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
}

.unknowns-field-box {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    color: white;
    padding: 12px 20px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: bold;
    text-align: center;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    transition: all 0.3s ease;
    font-family: 'Poppins', sans-serif;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.unknowns-field-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
}

.unknowns-action {
    text-align: center;
    margin-top: 30px;
}

.unknowns-action-text {
    color: rgba(255,255,255,0.9);
    font-size: 16px;
    line-height: 1.5;
    margin-bottom: 20px;
}

.unknowns-profile-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 15px 30px;
    background: linear-gradient(135deg, #4a90e2, #2a5298);
    color: white;
    text-decoration: none;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
}

.unknowns-profile-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
    background: linear-gradient(135deg, #5aa0f2, #3a62a8);
}

.profile-btn-icon {
    font-size: 18px;
}

.profile-btn-text {
    font-size: 16px;
    font-weight: 600;
}

/* Loading */
.loading {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-size: 24px;
}

/* Responsive */
@media (max-width: 768px) {
    .container {
        padding: 0;
        height: 100vh;
        overflow-y: auto;
    }
    
    .slide-content {
        padding: 20px 10px;
    }
    
    .funfact-content,
    .letter-container,
    .breed-content,
    .share-content,
    .unknowns-content {
        padding: 20px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    /* Mobile portrait centering */
    .portrait-image-fullscreen {
        width: auto !important;
        height: auto !important;
        max-width: 95% !important;
        max-height: 70vh !important;
        object-fit: contain !important;
    }
    
    .portrait-slide {
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        min-height: 100vh !important;
        padding: 10px !important;
    }
}
</style>

<div class="container">
    <!-- Arrow Navigation -->
    <button class="slide-arrow-nav prev" id="prev-arrow" onclick="prevSlide()" disabled>
        <i class="fas fa-chevron-left"></i>
    </button>
    <button class="slide-arrow-nav next" id="next-arrow" onclick="nextSlide()">
        <i class="fas fa-chevron-right"></i>
    </button>

    <!-- Debug Info (temporary) -->
    <div style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 1000;">
        <strong>Debug Info:</strong><br>
        Food Fun Fact: {{ customer_data.food_fun_fact is defined }}<br>
        Portrait: {{ customer_data.portrait is defined }}<br>
        Letter: {{ customer_data.letter is defined }}<br>
        Badge: {{ customer_data.badge is defined }}<br>
        Breed: {{ customer_data.breed_prediction is defined }}<br>
        Consolidated: {{ customer_data.consolidated_queries is defined }}<br>
        Unknowns: {{ customer_data.unknowns is defined }}
    </div>

    <!-- Loading Slide -->
    <div class="slide active" id="slide-0">
        <div class="slide-content loading-slide">
            <div class="loading">
                <h2>Loading your personalized Chewy experience...</h2>
                <p>Please wait while we prepare your data</p>
            </div>
        </div>
    </div>

    <!-- Slide 1: Food Fun Fact -->
    {% if customer_data.food_fun_fact and customer_data.food_fun_fact.total_food_lbs and customer_data.food_fun_fact.total_food_lbs > 0 %}
    <div class="slide" id="slide-1">
        <div class="slide-content funfact-slide">
            <div class="slide-header" style="text-align: center; margin-bottom: 20px;">
                <h2 class="slide-title" style="text-align: center; margin: 0; font-family: 'Poppins', sans-serif; font-weight: 600;">
                    Total lbs of food consumed
                </h2>
            </div>
            
            <div class="spotify-wrapped-container">
                <div class="wrapped-number" id="food-number">{{ customer_data.food_fun_fact.total_food_lbs }}</div>
                <div class="wrapped-text-line">lbs to be exact.</div>
                </div>
            
                    {% if customer_data.food_fun_fact.fun_facts %}
                <div class="funfact-messages">
                    {% for fun_fact in customer_data.food_fun_fact.fun_facts %}
                    <p class="funfact-message">{{ fun_fact }}</p>
                    {% endfor %}
                    </div>
                    {% endif %}
            
            <div class="slide-counter">1 of 8</div>
        </div>
    </div>
    {% endif %}

    <!-- Slide 2: AI Portrait -->
    {% if customer_data.portrait %}
    <div class="slide" id="slide-2">
        <div class="slide-content portrait-slide" style="display: flex; flex-direction: column; justify-content: flex-start; align-items: center; min-height: 100vh; padding-top: 20px;">
            <div class="slide-header" style="text-align: center; margin-bottom: 30px; order: 1;">
                <h2 class="slide-title" style="text-align: center; margin: 0; font-size: 20px;">
                    Your Pet Portrait
                </h2>
            </div>
            
            <img src="{{ customer_data.portrait }}" alt="Pet Portrait" class="portrait-image-fullscreen" style="width: auto; height: auto; max-width: 100%; max-height: 70vh; object-fit: contain; order: 2; flex: 1;">
            
            <div class="slide-counter" style="order: 3;">2 of 8</div>
        </div>
    </div>
    {% endif %}

    <!-- Slide 1.5: Busiest Month (when food consumption is 0/null) -->
    {% if customer_data.cuddliest_month and (not customer_data.food_fun_fact or not customer_data.food_fun_fact.total_food_lbs or customer_data.food_fun_fact.total_food_lbs == 0) %}
    <div class="slide" id="slide-1-busiest">
        <div class="slide-content busiest-slide">
            <div class="slide-header" style="text-align: center; margin-bottom: 30px;">
                <h2 class="slide-title" style="text-align: center; margin: 0;">
                    Your Busiest Month
                </h2>
            </div>
            
            <div class="busiest-container">
                <div class="busiest-icon">
                    <i class="fas fa-calendar-alt" style="font-size: 60px; color: white;"></i>
                </div>
                <div class="busiest-content">
                    <h3 class="busiest-title">Your Busiest Month</h3>
                    <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                        <h4 style="color: white; font-size: 32px; margin-bottom: 10px; text-align: center;">
                            {{ customer_data.cuddliest_month }}
                        </h4>
                        <p style="color: white; font-size: 18px; text-align: center; margin-bottom: 15px;">
                            This was your most active month with Chewy!
                        </p>
                    </div>
                    <div class="busiest-highlight">
                        <p class="busiest-text">
                            You were most engaged with Chewy during {{ customer_data.cuddliest_month }}. Keep up the great work taking care of your pets!
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="slide-counter">3 of 8</div>
        </div>
    </div>
    {% endif %}

    <!-- Slide 4: Letter to Human -->
    {% if customer_data.pet_letters %}
    <div class="slide" id="slide-3">
        <div class="slide-content letter-slide" style="display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; padding: 40px 20px; overflow-y: auto;">
            <div class="slide-header" style="text-align: center; margin-bottom: 30px; width: 100%;">
                <h2 class="slide-title" style="text-align: center; margin: 0; font-size: 32px; font-weight: 700; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                    A Letter from Your Pets
                </h2>
            </div>
            
            <div class="letter-container" style="margin: 0 auto; padding: 30px; max-width: 600px; width: 100%; background: rgba(255,255,255,0.15); border: 2px solid rgba(255,255,255,0.3); border-radius: 20px; backdrop-filter: blur(15px); text-align: left; font-size: 16px; line-height: 1.8; white-space: pre-wrap; font-family: 'Poppins', sans-serif; font-weight: 400; color: white; box-shadow: 0 15px 35px rgba(0,0,0,0.2); overflow: visible;">
                {% if customer_data.pet_letters %}
                    {% set letter_text = customer_data.pet_letters %}
                    {% if letter_text %}
                        {% set lines = letter_text.split('\n') %}
                        {% for line in lines %}
                            {% if not line.startswith('Collective Letter from All Pets for Customer') and not line.startswith('=') %}
                                {% if line.strip() %}
                                    <p style="margin: 0 0 6px 0; padding: 0;">{{ line }}</p>
                                {% else %}
                                    <br>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endif %}
            </div>
            
            <div class="slide-counter">4 of 8</div>
        </div>
    </div>
    {% endif %}

    <!-- Slide 4: Personality Badge -->
    {% if customer_data.badge %}
    <div class="slide" id="slide-4">
        <div class="slide-content badge-slide">
            <div class="household-personality-container" style="padding: 0; gap: 20px;">
                <!-- Large bold title -->
                <h1 class="household-title" style="margin-top: 0;">Household Personality for Your Pets</h1>
                
                <!-- Central circular badge section -->
                <div class="central-badge-section">
                    <div class="badge-circle">
                        <img src="{{ customer_data.badge.image_path }}" alt="Personality Badge" class="central-badge-image">
                    </div>
                    <h2 class="badge-label">{{ customer_data.badge.badge }}</h2>
            </div>
            
                <!-- Horizontal personality words -->
                <div class="personality-words-section">
                    <div class="personality-word">Playful</div>
                    <div class="personality-word">Loyal</div>
                    <div class="personality-word">Gentle</div>
                </div>
                
                <!-- Compatible With section -->
                <div class="compatible-with-section">
                    <h3 class="compatible-with-title">Compatible With</h3>
                    <div class="compatible-badges-row">
                        <div class="compatible-badge-small">
                            <img src="/static/badges/badge_athlete copy.png" alt="Athlete Badge" class="compatible-badge-small-image">
                            <span class="compatible-badge-small-name">Athlete</span>
                        </div>
                        <div class="compatible-badge-small">
                            <img src="/static/badges/badge_cuddler copy.png" alt="Cuddler Badge" class="compatible-badge-small-image">
                            <span class="compatible-badge-small-name">Cuddler</span>
                        </div>
                        <div class="compatible-badge-small">
                            <img src="/static/badges/badge_explorer copy.png" alt="Explorer Badge" class="compatible-badge-small-image">
                            <span class="compatible-badge-small-name">Explorer</span>
                        </div>
                </div>
            </div>
            
                <!-- Call-to-action button -->
                <div class="share-cta-section">
                    <button class="share-cta-button" onclick="shareToSocial('facebook')">
                        Share to discover your pet's friends
                </button>
            </div>
            </div>
            
            <div class="slide-counter">5 of 8</div>
        </div>
    </div>
    {% endif %}

    <!-- Slide 5: Breed Prediction - First Display -->
    {% if customer_data.breed_prediction %}
    <div class="slide" id="slide-5">
        <div class="slide-content breed-slide">
            <div class="breed-container" style="margin-top: 40px;">
                <h2 class="slide-title" style="text-align: center; margin: 0; margin-bottom: 30px;">
                    Our Breed Predictions
                </h2>
                    
                    <!-- Pet Highlight Section -->
                    <div class="breed-pet-highlight">
                        <p class="breed-highlight-text">
                            We are highlighting <strong>
                                {% if customer_data.breed_prediction.multiple_predictions %}
                                    {{ customer_data.breed_prediction.multiple_predictions[0].pet_name }}
                                {% elif customer_data.breed_prediction.pet_name %}
                                    {{ customer_data.breed_prediction.pet_name }}
                                {% else %}
                                    your pet
                                {% endif %}
                            </strong>
                        </p>
                    </div>
                    
                    <!-- Step 1: Breed Predictions Grid -->
                    <div class="breed-predictions-card" id="breed-predictions-card">
                        <h4 class="breed-predictions-title">Our Top Predictions</h4>
                    <div class="breed-predictions-grid" id="breed-predictions-grid">
                        {% if customer_data.breed_prediction.multiple_predictions %}
                                {# Handle multiple predictions structure #}
                                {% set first_prediction = customer_data.breed_prediction.multiple_predictions[0] %}
                                {% if first_prediction.prediction and first_prediction.prediction.breed_distribution %}
                                    {% for breed_name, percentage in first_prediction.prediction.breed_distribution.items() %}
                                    <div class="breed-card" onclick="handleBreedCardClick(event)" data-breed="{{ breed_name }}" data-pet="{{ first_prediction.pet_name }}" data-confidence="{{ percentage }}" data-explanation="{{ first_prediction.prediction.explanations[breed_name] if first_prediction.prediction.explanations and breed_name in first_prediction.prediction.explanations else 'No explanation available' }}">
                                        <div class="breed-card-content">
                                            <div class="breed-card-name">{{ breed_name | format_breed_name_simple }}</div>
                                            <div class="breed-card-percentage">{{ "%.1f"|format(percentage) }}%</div>
                                            <div class="breed-card-checkbox" style="display: none;">
                                                <input type="checkbox" class="breed-checkbox" onchange="showIKnewIt()">
                                                <label class="breed-checkbox-label">Check</label>
                                            </div>
                                        </div>
                            </div>
                            {% endfor %}
                        {% else %}
                                    <div class="breed-card" onclick="handleBreedCardClick(event)" data-breed="{{ first_prediction.predicted_breed }}" data-pet="{{ first_prediction.pet_name }}" data-confidence="100" data-explanation="No explanation available">
                                        <div class="breed-card-content">
                                            <div class="breed-card-name">{{ first_prediction.predicted_breed }}</div>
                                            <div class="breed-card-percentage">100%</div>
                                            <div class="breed-card-checkbox" style="display: none;">
                                                <input type="checkbox" class="breed-checkbox" onchange="handleBreedCheckboxChange(event)">
                                                <label class="breed-checkbox-label">Check</label>
                            </div>
                    </div>
                        </div>
                                {% endif %}
                            {% elif customer_data.breed_prediction.prediction %}
                                {# Handle single prediction structure #}
                                {% if customer_data.breed_prediction.prediction.breed_distribution %}
                                    {% for breed_name, percentage in customer_data.breed_prediction.prediction.breed_distribution.items() %}
                                    <div class="breed-card" onclick="handleBreedCardClick(event)" data-breed="{{ breed_name }}" data-pet="{{ customer_data.breed_prediction.pet_name }}" data-confidence="{{ percentage }}" data-explanation="{{ customer_data.breed_prediction.prediction.explanations[breed_name] if customer_data.breed_prediction.prediction.explanations and breed_name in customer_data.breed_prediction.prediction.explanations else 'No explanation available' }}">
                                        <div class="breed-card-content">
                                            <div class="breed-card-name">{{ breed_name | format_breed_name_simple }}</div>
                                            <div class="breed-card-percentage">{{ "%.1f"|format(percentage) }}%</div>
                                            <div class="breed-card-checkbox" style="display: none;">
                                                <input type="checkbox" class="breed-checkbox" onchange="showIKnewIt()">
                                                <label class="breed-checkbox-label">Check</label>
                    </div>
                                        </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                    <div class="breed-card" onclick="handleBreedCardClick(event)" data-breed="{{ customer_data.breed_prediction.predicted_breed }}" data-pet="{{ customer_data.breed_prediction.pet_name }}" data-confidence="100" data-explanation="No explanation available">
                                        <div class="breed-card-content">
                                            <div class="breed-card-name">{{ customer_data.breed_prediction.predicted_breed }}</div>
                                            <div class="breed-card-percentage">100%</div>
                                            <div class="breed-card-checkbox" style="display: none;">
                                                <input type="checkbox" class="breed-checkbox" onchange="handleBreedCheckboxChange(event)">
                                                <label class="breed-checkbox-label">Check</label>
                                            </div>
                                        </div>
                                </div>
                            {% endif %}
                            {% else %}
                                <div class="breed-card" onclick="handleBreedCardClick(event)" data-breed="{{ customer_data.breed_prediction.predicted_breed }}" data-pet="Unknown" data-confidence="100" data-explanation="No explanation available">
                                    <div class="breed-card-content">
                                        <div class="breed-card-name">{{ customer_data.breed_prediction.predicted_breed }}</div>
                                        <div class="breed-card-percentage">100%</div>
                                        <div class="breed-card-checkbox" style="display: none;">
                                            <input type="checkbox" class="breed-checkbox" onchange="handleBreedCheckboxChange(event)">
                                            <label class="breed-checkbox-label">Check</label>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Step 2: Question -->
                    <div class="breed-question-section" id="breed-question-section" style="display: block;">
                        <h4 class="breed-question-title">Did we get any right?</h4>
                        <div class="breed-question-buttons">
                            <button class="breed-question-btn breed-yes-btn" onclick="handleBreedYes()">
                                <span class="breed-btn-emoji"></span>
                                <span class="breed-btn-text">Yes</span>
                            </button>
                            <button class="breed-question-btn breed-no-btn" onclick="handleBreedNo()">
                                <span class="breed-btn-emoji"></span>
                                <span class="breed-btn-text">No</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: No Response -->
                    <div class="breed-no-response" id="breed-no-response" style="display: none;">
                        <div class="breed-no-content">
                            <h4 class="breed-no-title">We thought we had it </h4>
                            <p class="breed-no-message">Help us improve our predictions by completing your pet profiles.</p>
                            <div class="breed-profile-link-section">
                                <a href="https://www.chewy.com/account/profile" target="_blank" class="breed-profile-link">
                                    Complete Pet Profile
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Breed Flashcard Modal -->
                <div class="breed-flashcard-modal" id="breed-flashcard-modal">
                    <div class="breed-flashcard-content">
                        <div class="breed-flashcard-header">
                            <h3 id="flashcard-breed-name">Breed Name</h3>
                            <button class="breed-flashcard-close" onclick="closeBreedFlashcard()"></button>
                        </div>
                        <div class="breed-flashcard-body">
                            <div class="breed-flashcard-info">
                                <div class="breed-flashcard-pet">For: <span id="flashcard-pet-name">Pet Name</span></div>
                                <div class="breed-flashcard-confidence">Confidence: <span id="flashcard-confidence">100%</span></div>
                            </div>
                            <div class="breed-flashcard-description" id="flashcard-description">
                                <p>Loading breed information...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="slide-counter">6 of 8</div>
            </div>
    </div>
    {% endif %}

    <!-- Slide 6: Your Other Stats -->
    <div class="slide" id="slide-6">
        <div class="slide-content stats-slide" style="overflow-y: auto; min-height: 100vh; padding: 20px 15px 80px 15px;">
            <div class="slide-header" style="text-align: center; margin-bottom: 30px;">
                <h2 class="slide-title" style="text-align: center; margin: 0; font-family: 'Poppins', sans-serif; font-weight: 600;">
                    Your Chewy Stats
                </h2>
            </div>
                <div class="stats-list" style="display: flex; flex-direction: column; gap: 20px; max-width: 600px; margin: 0 auto;">
                    {% if customer_data.total_months and customer_data.total_months > 0 %}
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 15px 20px; animation: slideInFromBottom 0.8s ease-out 0.2s both; opacity: 0; transform: translateY(30px);">
                        <div style="color: white; font-size: 24px; font-weight: 700; text-align: left;">{{ customer_data.total_months }}</div>
                        <div style="color: white; font-size: 16px; opacity: 0.9; text-align: right; word-wrap: break-word;">Months with Chewy</div>
                    </div>
                    {% endif %}
                    
                    {% if customer_data.autoship_savings and customer_data.autoship_savings > 0 %}
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 15px 20px; animation: slideInFromBottom 0.8s ease-out 0.4s both; opacity: 0; transform: translateY(30px);">
                        <div style="color: white; font-size: 24px; font-weight: 700; text-align: left;">${{ "%.2f"|format(customer_data.autoship_savings) }}</div>
                        <div style="color: white; font-size: 16px; opacity: 0.9; text-align: right; word-wrap: break-word;">Autoship Savings</div>
                    </div>
                    {% endif %}
                    
                    {% if customer_data.cuddliest_month and customer_data.cuddliest_month != "N/A" and customer_data.cuddliest_month != "" %}
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 15px 20px; animation: slideInFromBottom 0.8s ease-out 0.6s both; opacity: 0; transform: translateY(30px);">
                        <div style="color: white; font-size: 24px; font-weight: 700; text-align: left;">{{ customer_data.cuddliest_month }}</div>
                        <div style="color: white; font-size: 16px; opacity: 0.9; text-align: right; word-wrap: break-word;">Your Pet's Favorite Month (Most Orders!)</div>
                    </div>
                    {% endif %}
                    
                    {% if customer_data.amount_donated and customer_data.amount_donated > 0 %}
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 15px 20px; animation: slideInFromBottom 0.8s ease-out 0.8s both; opacity: 0; transform: translateY(30px);">
                        <div style="color: white; font-size: 24px; font-weight: 700; text-align: left;">${{ "%.2f"|format(customer_data.amount_donated) }}</div>
                        <div style="color: white; font-size: 16px; opacity: 0.9; text-align: right; word-wrap: break-word;">Amount Donated</div>
                    </div>
                    {% endif %}
                    
                    {% if customer_data.most_ordered and customer_data.most_ordered != "N/A" and customer_data.most_ordered != "" %}
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 15px 20px; animation: slideInFromBottom 0.8s ease-out 1.0s both; opacity: 0; transform: translateY(30px);">
                        <div style="color: white; font-size: 16px; font-weight: 700; opacity: 0.9; text-align: left;">Most Ordered</div>
                        <div style="color: white; font-size: 14px; opacity: 0.8; text-align: right; word-wrap: break-word;">{{ customer_data.most_ordered }}</div>
                    </div>
                    {% endif %}
                </div>
            
            <div class="slide-counter">7 of 8</div>
        </div>
    </div>

    <!-- Slide 7: Social Media Share -->
    <div class="slide" id="slide-7">
        <div class="slide-content share-slide" style="overflow-y: auto; min-height: 100vh; padding: 20px 15px 80px 15px;">
                                <div class="slide-header" style="text-align: center; margin-bottom: 30px;">
                        <h2 class="slide-title" style="text-align: center; margin: 0; font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 28px; color: white;">
                             Share Your Chewy Journey 
                        </h2>
                        <!-- <p style="color: white; font-size: 16px; margin-top: 12px; opacity: 0.9;">
                            Spread the love with friends and family!
                        </p> -->
                    </div>
            
            <div class="enhanced-share-container">
                <div class="enhanced-share-content">
                                                <div class="enhanced-share-text">
                                <h3 style="color: white; font-size: 20px; margin-bottom: 15px; font-weight: 600;">
                                     Your personalized experience is ready to share!
                                </h3>
                            </div>
                    
                    <div class="enhanced-social-grid">
                        <div class="enhanced-social-card facebook" onclick="shareToSocial('facebook')">
                            <div class="enhanced-social-icon">
                                <i class="fab fa-facebook-f"></i>
                            </div>
                            <div class="enhanced-social-label">Facebook</div>
                        </div>
                        
                        <div class="enhanced-social-card instagram" onclick="shareToSocial('instagram')">
                            <div class="enhanced-social-icon">
                                <i class="fab fa-instagram"></i>
                            </div>
                            <div class="enhanced-social-label">Instagram</div>
                        </div>
                        
                        <div class="enhanced-social-card snapchat" onclick="shareToSocial('snapchat')">
                            <div class="enhanced-social-icon">
                                <i class="fab fa-snapchat-ghost"></i>
                            </div>
                            <div class="enhanced-social-label">Snapchat</div>
                        </div>
                        
                        <div class="enhanced-social-card message" onclick="shareToSocial('message')">
                            <div class="enhanced-social-icon">
                                <i class="fas fa-comment"></i>
                            </div>
                            <div class="enhanced-social-label">Message</div>
                        </div>
                    </div>
                    
                    <div class="enhanced-share-cta">
                        <button class="enhanced-share-btn" onclick="shareToSocial('facebook')">
                            <span class="enhanced-share-icon"></span>
                            <span class="enhanced-share-text">Share Your Story</span>
                        </button>
                    </div>
                </div>
            </div>
            </div>
            
            <div class="slide-counter">8 of 8</div>
        </div>
    </div>

    <!-- Slide 8: Missing Pet Profile Information -->
    {% if customer_data.unknowns %}
    <div class="slide" id="slide-8">
        <div class="slide-content unknowns-slide" style="overflow-y: auto; min-height: 100vh; padding: 20px 15px 80px 15px;">
            <div class="slide-header" style="text-align: center; margin-bottom: 30px;">
                <h2 class="slide-title" style="text-align: center; margin: 0; font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 20px;">
                    Complete Your Pet Profiles
                </h2>
            </div>
            
            <div class="unknowns-container">
                <div class="unknowns-content">
                    <div class="unknowns-summary">
                        <p class="unknowns-summary-text">
                            We found {{ customer_data.unknowns.total_unknowns }} missing pieces of information across {{ customer_data.unknowns.pets_with_unknowns }} pet(s).
                        </p>
                        <p class="unknowns-summary-text">
                            Complete your pet profiles to get even more personalized insights!
                        </p>
                    </div>
                    
                    <div class="unknowns-pets-grid">
                        {% for pet_name, pet_data in customer_data.unknowns.unknown_attributes.items() %}
                        <div class="unknowns-pet-card">
                            <div class="unknowns-pet-name">
                                <span class="emoji"></span> {{ pet_data.pet_name | title }}
                            </div>
                            <div class="unknowns-fields-container">
                                {% for field in pet_data.unknown_fields %}
                                <a href="https://www.chewy.com/account/profile" target="_blank" class="unknowns-field-box" style="text-decoration: none; color: inherit; cursor: pointer;">
                                    {{ field.replace('_', ' ').title() }}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div class="slide-counter">8 of 8</div>
        </div>
    </div>
    {% endif %}
            
</div>

<script>
let currentSlide = 0;
let totalSlides = 0;
let isTransitioning = false;

// Initialize slides
document.addEventListener('DOMContentLoaded', function() {
    // Count total slides (excluding loading slide)
    const allSlides = document.querySelectorAll('.slide');
    totalSlides = allSlides.length - 1; // Subtract 1 for loading slide
    
    // Debug: Log all slides
    console.log(` Total slides: ${totalSlides}, All slides: ${allSlides.length}`);
    allSlides.forEach((slide, index) => {
        console.log(` Slide ${index}: ${slide.id} - visible: ${slide.style.display !== 'none'}`);
    });
    
    // Initialize arrow navigation
    updateArrowNavigation();
    
    // Initialize breed prediction slide
    initializeBreedPredictionSlide();
    
    // Hide loading slide after a short delay and show first real slide
    setTimeout(() => {
        console.log(` Showing slide 1...`);
        showSlide(1);
    }, 2000);
});

function showSlide(slideIndex) {
    console.log(` showSlide(${slideIndex}) called, currentSlide=${currentSlide}, isTransitioning=${isTransitioning}`);
    
    if (isTransitioning || slideIndex === currentSlide) {
        console.log(` Skipping slide change - transitioning: ${isTransitioning}, same slide: ${slideIndex === currentSlide}`);
        return;
    }
    
    isTransitioning = true;
    
    // Hide all slides
    const visibleSlides = Array.from(document.querySelectorAll('.slide'));
    console.log(` Found ${visibleSlides.length} slides total`);
    visibleSlides.forEach((slide, index) => {
        slide.classList.remove('active');
        console.log(` Slide ${index} (${slide.id}): removed active class`);
    });
    
    // Show target slide
    if (visibleSlides[slideIndex]) {
        visibleSlides[slideIndex].classList.add('active');
        currentSlide = slideIndex;
        console.log(` Activated slide ${slideIndex} (${visibleSlides[slideIndex].id})`);
        
        // Reset breed prediction state when navigating to breed slide
        if (slideIndex === 5) { // Breed prediction slide
            resetBreedPredictionState();
        }
        
        // Update arrow navigation states
        updateArrowNavigation();
    } else {
        console.log(` Slide ${slideIndex} not found!`);
    }
    
    setTimeout(() => {
        isTransitioning = false;
        console.log(` Transition complete`);
    }, 300);
}

function updateArrowNavigation() {
    const prevArrow = document.getElementById('prev-arrow');
    const nextArrow = document.getElementById('next-arrow');
    
    // Disable prev arrow on first slide (slide 1, since slide 0 is loading)
    if (currentSlide <= 1) {
        prevArrow.disabled = true;
        prevArrow.style.opacity = '0.3';
    } else {
        prevArrow.disabled = false;
        prevArrow.style.opacity = '1';
    }
    
    // Disable next arrow on last slide
    if (currentSlide >= totalSlides) {
        nextArrow.disabled = true;
        nextArrow.style.opacity = '0.3';
    } else {
        nextArrow.disabled = false;
        nextArrow.style.opacity = '1';
    }
    
    console.log(` Arrow navigation updated - currentSlide: ${currentSlide}, totalSlides: ${totalSlides}`);
}

function nextSlide() {
    console.log(` Next: currentSlide=${currentSlide}, totalSlides=${totalSlides}`);
    if (currentSlide < totalSlides) {
        showSlide(currentSlide + 1);
    }
}

function prevSlide() {
    console.log(` Prev: currentSlide=${currentSlide}, totalSlides=${totalSlides}`);
    if (currentSlide > 1) {
        showSlide(currentSlide - 1);
    }
}

function goHome() {
    window.location.href = '/';
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowRight' || e.key === ' ') {
        e.preventDefault();
        nextSlide();
    } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        prevSlide();
    } else if (e.key === 'Escape') {
        goHome();
    }
});

// Touch/swipe support for mobile
let touchStartX = 0;
let touchEndX = 0;

document.addEventListener('touchstart', function(e) {
    touchStartX = e.changedTouches[0].screenX;
});

document.addEventListener('touchend', function(e) {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
});

function handleSwipe() {
    const swipeThreshold = 50;
    const diff = touchStartX - touchEndX;
    
    if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
            // Swiped left - next slide
            nextSlide();
        } else {
            // Swiped right - previous slide
            prevSlide();
        }
    }
}



// Breed Prediction Interactive and Gamified Functions
let checkedBreeds = 0;
let totalBreeds = 0;
let isCardFlipped = false;

// Initialize breed count and event listeners
document.addEventListener('DOMContentLoaded', function() {
    const breedCheckboxes = document.querySelectorAll('.breed-checkbox');
    totalBreeds = breedCheckboxes.length;
    
    // Add event listeners for breed checkboxes
    breedCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            handleBreedCheck(this);
        });
    });
    
    // Add event listener for card flip
    const flipCard = document.getElementById('breed-flip-card');
    if (flipCard) {
        flipCard.addEventListener('click', function() {
            flipBreedCard();
        });
    }
});

function handleBreedCheck(checkbox) {
    if (checkbox.checked) {
        checkedBreeds++;
        // Add visual feedback
        checkbox.parentElement.style.background = 'rgba(76, 175, 80, 0.2)';
        checkbox.parentElement.style.border = '1px solid #4CAF50';
        } else {
        checkedBreeds--;
        // Remove visual feedback
        checkbox.parentElement.style.background = 'rgba(255, 255, 255, 0.1)';
        checkbox.parentElement.style.border = '1px solid rgba(255, 255, 255, 0.2)';
    }
    
    // Show question after all breeds are checked
    if (checkedBreeds === totalBreeds) {
        setTimeout(() => {
            showAccuracyQuestion();
        }, 500);
    }
}

function showAccuracyQuestion() {
    const questionCard = document.getElementById('breed-question-card');
    questionCard.style.display = 'block';
    questionCard.style.animation = 'fadeInUp 0.8s ease-out';
    
    // Add gamification feedback
    const predictionsCard = document.getElementById('breed-predictions-card');
    predictionsCard.style.background = 'rgba(76, 175, 80, 0.1)';
    predictionsCard.style.border = '1px solid #4CAF50';
}

function handleBreedYes() {
    // Show checkboxes on all breed cards
    const breedCards = document.querySelectorAll('.breed-card');
    breedCards.forEach(card => {
        const checkbox = card.querySelector('.breed-card-checkbox');
        if (checkbox) {
            checkbox.style.display = 'block';
        }
    });
    
    // Hide the question section
    const questionSection = document.getElementById('breed-question-section');
    if (questionSection) {
        questionSection.style.display = 'none';
    }
    
    // Show the update profile button
    const updateProfileBtn = document.getElementById('update-profile-btn');
    if (updateProfileBtn) {
        updateProfileBtn.style.display = 'block';
        updateProfileBtn.style.animation = 'fadeInUp 0.8s ease-out';
    }
    
    // Mark as interacted
    window.breedUserHasInteracted = true;
    window.breedAccuracyChoice = 'yes';
    window.checkedBreeds = [];
}

function handleBreedNo() {
    // Hide the breed grid
    const breedGrid = document.getElementById('breed-predictions-card');
    if (breedGrid) {
        breedGrid.style.display = 'none';
    }
    
    // Hide the question section
    const questionSection = document.getElementById('breed-question-section');
    if (questionSection) {
        questionSection.style.display = 'none';
    }
    
    // Show the "No" response
    const noResponse = document.getElementById('breed-no-response');
    if (noResponse) {
        noResponse.style.display = 'block';
        noResponse.style.animation = 'fadeInUp 0.8s ease-out';
    }
    
    // Mark as interacted
    window.breedUserHasInteracted = true;
    window.breedAccuracyChoice = 'no';
}

function handleAccuracyChoice(choice) {
    // Store the choice for the next slide
    window.breedAccuracyChoice = choice;
    
    // Navigate to the next slide (breed feedback slide)
    setTimeout(() => {
        showSlide(currentSlide + 1);
    }, 500);
}

function flipBreedCard() {
    const flipCard = document.getElementById('breed-flip-card');
    if (flipCard) {
        if (!isCardFlipped) {
            flipCard.style.transform = 'rotateY(180deg)';
            isCardFlipped = true;
            
            // Add flip feedback
            flipCard.style.boxShadow = '0 10px 30px rgba(255, 255, 255, 0.3)';
    } else {
            flipCard.style.transform = 'rotateY(0deg)';
            isCardFlipped = false;
            
            // Remove flip feedback
            flipCard.style.boxShadow = 'none';
        }
    }
}

function submitPetProfile() {
    const profileLink = document.getElementById('pet-profile-link').value;
    if (profileLink.trim()) {
        // Add gamification feedback
        const submitBtn = document.querySelector('.breed-profile-submit-btn');
        submitBtn.textContent = 'Submitted! ';
        submitBtn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
        submitBtn.style.transform = 'scale(1.05)';
        
        setTimeout(() => {
            alert('Thank you for submitting your pet profile! We\'ll use this to improve our predictions.');
        }, 500);
    } else {
        alert('Please enter a valid pet profile link.');
    }
}

function showIKnewIt() {
    // Create and show a popup message
    const popup = document.createElement('div');
    popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 20px 30px;
        border-radius: 15px;
        font-size: 18px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        animation: popupFadeIn 0.5s ease-out;
    `;
    popup.textContent = 'I knew it! ';
    
    // Add animation CSS
    const style = document.createElement('style');
    style.textContent = `
        @keyframes popupFadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(popup);
    
    // Remove popup after 2 seconds
    setTimeout(() => {
        popup.style.animation = 'popupFadeOut 0.5s ease-in';
        popup.style.cssText += `
            @keyframes popupFadeOut {
                from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                to { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            }
        `;
        setTimeout(() => {
            document.body.removeChild(popup);
        }, 500);
    }, 2000);
}

function handleBreedCheckboxChange(event) {
    // Prevent the flashcard from showing when checkbox is clicked
    event.stopPropagation();
    event.preventDefault();
    
    // Track checked breeds
    if (!window.checkedBreeds) {
        window.checkedBreeds = [];
    }
    
    const breedName = event.target.closest('.breed-card').getAttribute('data-breed');
    
    if (event.target.checked) {
        if (!window.checkedBreeds.includes(breedName)) {
            window.checkedBreeds.push(breedName);
        }
    } else {
        window.checkedBreeds = window.checkedBreeds.filter(breed => breed !== breedName);
    }
    
    console.log('Breed checkbox changed:', event.target.checked, 'Checked breeds:', window.checkedBreeds);
}

function handleBreedCardClick(event) {
    // Only show flashcard if the click wasn't on a checkbox or its label
    if (!event.target.closest('.breed-card-checkbox')) {
        const breedName = event.currentTarget.getAttribute('data-breed');
        const petName = event.currentTarget.getAttribute('data-pet');
        const confidence = event.currentTarget.getAttribute('data-confidence');
        const explanation = event.currentTarget.getAttribute('data-explanation');
        showBreedFlashcard(breedName, petName, confidence, explanation);
    }
}

function showBreedQuestionSection() {
    // Only show the question section if it hasn't been shown yet
    if (!window.breedQuestionShown) {
        const questionSection = document.querySelector('.breed-question-section');
        if (questionSection) {
            questionSection.style.display = 'block';
            questionSection.style.animation = 'fadeInUp 0.8s ease-out';
            window.breedQuestionShown = true;
            console.log(' Breed question section shown after user interaction');
        }
    }
}

function resetBreedPredictionState() {
    // Reset breed prediction interactive elements when navigating to the slide
    console.log(' Resetting breed prediction state...');
    
    // Check if user has already interacted with the breed prediction
    if (window.breedUserHasInteracted) {
        // Show updated state with visual feedback
        showBreedPredictionUpdatedState();
        } else {
        // Show question section for first-time visit
        const questionSection = document.querySelector('.breed-question-section');
        const noResponseSection = document.querySelector('.breed-no-response');
        const updateProfileSection = document.querySelector('.update-profile-section');
        
        if (questionSection) {
            questionSection.style.display = 'block';
            questionSection.style.animation = 'fadeInUp 0.8s ease-out';
        }
        if (noResponseSection) noResponseSection.style.display = 'none';
        if (updateProfileSection) updateProfileSection.style.display = 'none';
        
        // Reset state flags
        window.breedQuestionShown = true; // Mark as shown since it's visible
        window.breedAccuracyChoice = null;
        
        console.log(' Breed prediction state reset - question section shown');
    }

function showBreedPredictionUpdatedState() {
    console.log(' Showing breed prediction updated state...');
    
    // Hide interactive elements
    const questionSection = document.querySelector('.breed-question-section');
    const noResponseSection = document.querySelector('.breed-no-response');
    const updateProfileSection = document.querySelector('.update-profile-section');
    
    if (questionSection) questionSection.style.display = 'none';
    if (noResponseSection) noResponseSection.style.display = 'none';
    if (updateProfileSection) updateProfileSection.style.display = 'none';
    
    // Update breed cards with visual states and remove checkboxes
    const breedCards = document.querySelectorAll('.breed-card');
    breedCards.forEach(card => {
        const checkboxContainer = card.querySelector('.breed-card-checkbox');
        const breedNameElement = card.querySelector('.breed-card-name');
        const breedPercentageElement = card.querySelector('.breed-card-percentage');
        
        // Remove checkbox container entirely
        if (checkboxContainer) {
            checkboxContainer.style.display = 'none';
        }
        
        // Get all checkboxes to determine checked state
        const allCheckboxes = document.querySelectorAll('.breed-checkbox');
        const checkedBreeds = [];
        
        allCheckboxes.forEach(checkbox => {
            if (checkbox.checked) {
                const breedCard = checkbox.closest('.breed-card');
                const breedName = breedCard.getAttribute('data-breed');
                checkedBreeds.push(breedName);
            }
        });
        
        const breedName = card.getAttribute('data-breed');
        const isChecked = checkedBreeds.includes(breedName);
        
        // Apply visual states
        if (isChecked) {
            //  Green for checked breeds
            card.style.background = 'linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1))';
            card.style.border = '2px solid #4CAF50';
            card.style.boxShadow = '0 4px 15px rgba(76, 175, 80, 0.3)';
            
            // Green text
            if (breedNameElement) breedNameElement.style.color = '#4CAF50';
            if (breedPercentageElement) breedPercentageElement.style.color = '#4CAF50';
            
            // Add checkmark
            if (!card.querySelector('.breed-checkmark')) {
                const checkmark = document.createElement('div');
                checkmark.className = 'breed-checkmark';
                checkmark.innerHTML = '';
                checkmark.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    font-size: 16px;
                    color: #4CAF50;
                `;
                card.appendChild(checkmark);
            }
        } else {
            //  Red for unchecked breeds
            card.style.background = 'linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(244, 67, 54, 0.1))';
            card.style.border = '2px solid #F44336';
            card.style.boxShadow = '0 4px 15px rgba(244, 67, 54, 0.3)';
            
            // Red text
            if (breedNameElement) breedNameElement.style.color = '#F44336';
            if (breedPercentageElement) breedPercentageElement.style.color = '#F44336';
            
            // Add X mark
            if (!card.querySelector('.breed-xmark')) {
                const xmark = document.createElement('div');
                xmark.className = 'breed-xmark';
                xmark.innerHTML = '';
                xmark.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    font-size: 16px;
                    color: #F44336;
                `;
                card.appendChild(xmark);
            }
        }
    });
    
    // Show "Already updated" message
    showAlreadyUpdatedMessage();
    
    console.log(' Breed prediction updated state applied - checkboxes removed');
}

function showAlreadyUpdatedMessage() {
    // Remove existing message if any
    const existingMessage = document.querySelector('.already-updated-message');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // Create and add the message
    const message = document.createElement('div');
    message.className = 'already-updated-message';
    message.innerHTML = '<span style="color: white; font-size: 18px; text-align: center; display: block; margin-top: 30px; font-weight: 500;"> Already updated</span>';
    message.style.cssText = `
        text-align: center;
        margin-top: 30px;
        animation: fadeInUp 0.8s ease-out;
        padding: 15px;
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
        border-radius: 10px;
        border: 1px solid rgba(76, 175, 80, 0.3);
    `;
    
    // Add to breed container
    const breedContainer = document.querySelector('.breed-container');
    if (breedContainer) {
        breedContainer.appendChild(message);
    }
}
}

function updatePetProfile() {
    // Get the pet name from the page
    const petHighlight = document.querySelector('.breed-highlight-text strong');
    let petName = 'your pet';
    if (petHighlight) {
        petName = petHighlight.textContent.trim();
    }
    
    // Create a personalized popup message
    const popup = document.createElement('div');
    popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 20px 30px;
        border-radius: 15px;
        font-size: 18px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        animation: popupFadeIn 0.5s ease-out;
        text-align: center;
    `;
    popup.innerHTML = `<div>${petName}'s pet profile is updated! </div>`;
    
    document.body.appendChild(popup);
    
    // Remove the popup after 3 seconds
    setTimeout(() => {
        popup.style.animation = 'popupFadeOut 0.5s ease-out';
        setTimeout(() => {
            if (popup.parentNode) {
                popup.parentNode.removeChild(popup);
            }
        }, 500);
    }, 3000);
    
    // Hide the update profile button
    const updateProfileBtn = document.getElementById('update-profile-btn');
    if (updateProfileBtn) {
        updateProfileBtn.style.display = 'none';
    }
    
    // Mark as interacted
    window.breedUserHasInteracted = true;
}

function completePetProfile() {
    // Open Chewy profile page in new tab
    window.open('https://www.chewy.com/account/profile', '_blank');
}

function initializeBreedPredictionSlide() {
    // Initialize breed prediction slide with question visible
    console.log(' Initializing breed prediction slide...');
    
    // Show question section initially
    const questionSection = document.querySelector('.breed-question-section');
    if (questionSection) {
        questionSection.style.display = 'block';
        questionSection.style.animation = 'fadeInUp 0.8s ease-out';
    }
    
    // Hide other interactive elements initially
    const noResponseSection = document.querySelector('.breed-no-response');
    const updateProfileSection = document.querySelector('.update-profile-section');
    
    if (noResponseSection) noResponseSection.style.display = 'none';
    if (updateProfileSection) updateProfileSection.style.display = 'none';
    
    console.log(' Breed prediction question section shown initially');
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Page is ready
});

function showBreedFlashcardFromData(element) {
    const breedName = element.getAttribute('data-breed');
    const petName = element.getAttribute('data-pet');
    const confidence = element.getAttribute('data-confidence');
    const explanation = element.getAttribute('data-explanation');
    showBreedFlashcard(breedName, petName, confidence, explanation);
}

function showBreedFlashcard(breedName, petName, confidence, explanation) {
    console.log(` Showing flashcard for ${breedName} (${petName}) - ${confidence}%`);
    
    // Update flashcard content
    document.getElementById('flashcard-breed-name').textContent = breedName.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
    document.getElementById('flashcard-pet-name').textContent = petName;
    document.getElementById('flashcard-confidence').textContent = confidence + '%';
    
    // Use the explanation if provided, otherwise fall back to breed description
    let description;
    if (explanation && explanation !== 'No explanation available') {
        description = `
            <h4>${breedName.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</h4>
            <p><strong>Confidence:</strong> ${confidence}%</p>
            <p><strong>Reasoning:</strong></p>
            <p style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 10px;">
                ${explanation}
            </p>
        `;
    } else {
    // Get breed description from our database
        description = getBreedDescription(breedName);
    }
    
    document.getElementById('flashcard-description').innerHTML = description;
    
    // Show the modal
    document.getElementById('breed-flashcard-modal').style.display = 'block';
}

function closeBreedFlashcard() {
    document.getElementById('breed-flashcard-modal').style.display = 'none';
}

function getBreedDescription(breedName) {
    // Breed descriptions database
    const breedDescriptions = {
        'Shih Tzu': `
            <h4>Shih Tzu</h4>
            <p><strong>Size:</strong> Small (9-16 lbs)</p>
            <p><strong>Temperament:</strong> Affectionate, friendly, and outgoing. Known for their sweet, gentle nature and love of companionship.</p>
            <p><strong>Characteristics:</strong> Long, flowing coat, distinctive pushed-in face, and a proud carriage. Excellent companion dogs that adapt well to apartment living.</p>
            <p><strong>Care:</strong> Requires regular grooming due to their long coat. Moderate exercise needs and thrives on human interaction.</p>
        `,
        'Golden Retriever': `
            <h4>Golden Retriever</h4>
            <p><strong>Size:</strong> Large (55-75 lbs)</p>
            <p><strong>Temperament:</strong> Intelligent, friendly, and devoted. Known for their gentle temperament and patience with children.</p>
            <p><strong>Characteristics:</strong> Beautiful golden coat, muscular build, and kind expression. Excellent family dogs and working dogs.</p>
            <p><strong>Care:</strong> Regular exercise and grooming needed. Highly trainable and eager to please.</p>
        `,
        'Labrador Retriever': `
            <h4>Labrador Retriever</h4>
            <p><strong>Size:</strong> Large (55-80 lbs)</p>
            <p><strong>Temperament:</strong> Friendly, outgoing, and high-spirited. Known for their intelligence and versatility.</p>
            <p><strong>Characteristics:</strong> Short, dense coat, otter-like tail, and kind expression. Excellent working dogs and family companions.</p>
            <p><strong>Care:</strong> High energy levels require regular exercise. Easy to groom and highly trainable.</p>
        `,
        'German Shepherd': `
            <h4>German Shepherd</h4>
            <p><strong>Size:</strong> Large (50-90 lbs)</p>
            <p><strong>Temperament:</strong> Intelligent, loyal, and courageous. Known for their protective nature and working ability.</p>
            <p><strong>Characteristics:</strong> Strong, muscular build, erect ears, and confident stance. Excellent working dogs and family protectors.</p>
            <p><strong>Care:</strong> Requires mental and physical stimulation. Regular grooming and training essential.</p>
        `,
        'Mixed / Unknown': `
            <h4>Mixed Breed</h4>
            <p><strong>Size:</strong> Variable</p>
            <p><strong>Temperament:</strong> Unique combination of traits from different breeds. Often healthy and adaptable.</p>
            <p><strong>Characteristics:</strong> One-of-a-kind appearance and personality. Each mixed breed is truly unique!</p>
            <p><strong>Care:</strong> Care needs depend on the mix of breeds. Generally adaptable and loving companions.</p>
        `,
        'Other': `
            <h4>Special Breed</h4>
            <p><strong>Size:</strong> Variable</p>
            <p><strong>Temperament:</strong> Unique and special! Every breed has its own wonderful characteristics.</p>
            <p><strong>Characteristics:</strong> Your pet is one-of-a-kind with their own special traits and personality.</p>
            <p><strong>Care:</strong> Each breed has specific care requirements that make them special.</p>
        `
    };
    
    // Return description or default
    return breedDescriptions[breedName] || `
        <h4>${breedName}</h4>
        <p>This is a wonderful breed with unique characteristics and personality traits!</p>
        <p>Every breed has its own special qualities that make them perfect companions.</p>
        <p>Your pet's individual personality makes them truly special regardless of breed.</p>
    `;
}

// Close flashcard when clicking outside
document.addEventListener('click', function(e) {
    const modal = document.getElementById('breed-flashcard-modal');
    const content = document.querySelector('.breed-flashcard-content');
    
    if (e.target === modal) {
        closeBreedFlashcard();
    }
});

// Social Media Sharing Functions
function shareToSocial(platform) {
    const customerId = '{{ customer_id }}';
    const shareUrl = `${window.location.origin}/experience/${customerId}`;
    const shareText = "Check out my personalized Chewy pet experience! ";
    
    let shareLink = '';
    
    switch(platform) {
        case 'facebook':
            shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`;
            break;
        case 'instagram':
            // Instagram doesn't support direct sharing via URL, so we'll copy to clipboard
            copyToClipboard(`${shareText} ${shareUrl}`);
            alert('Link copied to clipboard! You can now paste it in Instagram.');
            return;
        case 'snapchat':
            // Snapchat doesn't support direct sharing via URL, so we'll copy to clipboard
            copyToClipboard(`${shareText} ${shareUrl}`);
            alert('Link copied to clipboard! You can now paste it in Snapchat.');
            return;
        case 'whatsapp':
            shareLink = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
            break;
        case 'message':
            // For SMS sharing
            if (navigator.share) {
                navigator.share({
                    title: 'My Chewy Experience',
                    text: shareText,
                    url: shareUrl
                });
            } else {
                shareLink = `sms:?body=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
            }
            break;
    }
    
    if (shareLink) {
        window.open(shareLink, '_blank', 'width=600,height=400');
    }
}

function copyToClipboard(text) {
    if (navigator.clipboard) {
        navigator.clipboard.writeText(text);
    } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
    }
}

// Highlight number + item patterns in fun facts
function highlightFunFactNumbers() {
    const funFactMessages = document.querySelectorAll('.funfact-message');
    
    funFactMessages.forEach(message => {
        const text = message.innerHTML;
        // Regex to match patterns like "2 black bears", "5 tennis balls", etc.
        const highlightedText = text.replace(/(\d+(?:\.\d+)?)\s+([a-zA-Z\s]+)/g, 
            '<span class="highlight-number">$1 $2</span>');
        message.innerHTML = highlightedText;
    });
}

// Run highlighting when page loads
document.addEventListener('DOMContentLoaded', function() {
    highlightFunFactNumbers();
});
</script>
{% endblock %} 