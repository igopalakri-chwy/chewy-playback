<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chewy Playback - Generic Experience</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        .slide {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
        }

        .slide.active {
            display: flex;
        }

        .slide-title {
            font-size: 2.5em;
            color: #ffffff !important;
            margin-bottom: 30px;
            text-shadow: none !important;
            filter: none !important;
            box-shadow: none !important;
            -webkit-text-shadow: none !important;
            -moz-text-shadow: none !important;
        }

        .slide-value {
            font-size: 4em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .slide-description {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .nav-buttons {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .nav-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        /* Social Media Icons */
        .social-media-icons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .social-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .social-icon:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .social-icon i {
            font-size: 32px;
            color: white;
        }

        .social-label {
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }

        /* Social Media Brand Colors */
        .social-icon.facebook:hover {
            background: linear-gradient(135deg, #1877f2, #0d6efd);
            border-color: #1877f2;
        }

        .social-icon.snapchat:hover {
            background: linear-gradient(135deg, #fffc00, #ffd700);
            border-color: #fffc00;
        }

        .social-icon.snapchat:hover i,
        .social-icon.snapchat:hover .social-label {
            color: #000;
        }

        .social-icon.instagram:hover {
            background: linear-gradient(135deg, #e4405f, #c13584);
            border-color: #e4405f;
        }

        .social-icon.whatsapp:hover {
            background: linear-gradient(135deg, #25d366, #128c7e);
            border-color: #25d366;
        }

        .social-icon.message:hover {
            background: linear-gradient(135deg, #4a90e2, #2a5298);
            border-color: #4a90e2;
        }

        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.5em;
            color: #667eea;
        }

        .error {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.5em;
            color: #e74c3c;
        }

        .slide-counter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.1);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Debug button (temporary) -->
        <div style="position: fixed; top: 10px; right: 10px; z-index: 1000; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px;">
            <button onclick="showSlide(8)" style="background: #4a90e2; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Test Slide 8</button>
            <button onclick="console.log('Current slide:', currentSlide)" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-left: 5px;">Log Current</button>
        </div>
        
        <div id="loading" class="loading">
            <h2>Loading your Chewy experience...</h2>
            <p>Please wait while we fetch your data</p>
        </div>

        <div id="error" class="error" style="display: none;">
            <h2>âŒ Error</h2>
            <p id="error-message">Something went wrong</p>
            <button class="nav-btn" onclick="window.history.back()">Go Back</button>
        </div>

        <div id="slides-container" style="display: none;">
            <!-- Food Fun Fact Slide -->
            <div class="slide active" id="slide-1">
                <h1 class="slide-title">ğŸ½ï¸ Your Pet's Food Journey ğŸ½ï¸</h1>
                <div class="slide-value" id="food-fun-fact-value">0 lbs</div>
                <p class="slide-description" id="food-fun-fact-message">Your pets have consumed food this year!</p>
                <p class="slide-description" id="food-fun-fact-details">That's a lot of love for your pets! ğŸ¾</p>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="nextSlide()">Continue Journey â†’</button>
                </div>
                <div class="slide-counter">1 of 6</div>
            </div>

            <!-- Cuddliest Month Slide (Busiest Month) -->
            <div class="slide" id="slide-2">
                <h1 class="slide-title">ğŸ“… Cuddliest Month ğŸ“…</h1>
                <div class="slide-value" id="cuddliest-month-value">N/A</div>
                <p class="slide-description">Your Cuddliest Month</p>
                <p class="slide-description">This was your busiest month with Chewy! ğŸ’•</p>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="prevSlide()">â† Previous</button>
                    <button class="nav-btn" onclick="nextSlide()">Next â†’</button>
                </div>
                <div class="slide-counter">2 of 6</div>
            </div>

            <!-- Donations Slide -->
            <div class="slide" id="slide-3">
                <h1 class="slide-title">â¤ï¸ Donations â¤ï¸</h1>
                <div class="slide-value" id="donations-value">$0.00</div>
                <p class="slide-description">Total Donations This Year</p>
                <p class="slide-description">Your generous donations help pets in need find their forever homes. Thank you for making a difference! ğŸ¾</p>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="prevSlide()">â† Previous</button>
                    <button class="nav-btn" onclick="nextSlide()">Next â†’</button>
                </div>
                <div class="slide-counter">3 of 6</div>
            </div>

            <!-- Milestone Slide -->
            <div class="slide" id="slide-4">
                <h1 class="slide-title">ğŸŠ Milestone ğŸŠ</h1>
                <div class="slide-value" id="milestone-value">0</div>
                <p class="slide-description">Amazing Months with Chewy!</p>
                <p class="slide-description">You've been part of the Chewy family for an incredible <span id="milestone-text">0</span> months! Thank you for trusting us with your pets' care. ğŸ‰</p>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="prevSlide()">â† Previous</button>
                    <button class="nav-btn" onclick="nextSlide()">Next â†’</button>
                </div>
                <div class="slide-counter">4 of 6</div>
            </div>

            <!-- Most Reordered Slide -->
            <div class="slide" id="slide-5">
                <h1 class="slide-title">ğŸ”„ Most Reordered ğŸ”„</h1>
                <div class="slide-value">ğŸ†</div>
                <p class="slide-description">Your Favorite Product</p>
                <p class="slide-description" id="most-ordered-text">No data available</p>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="prevSlide()">â† Previous</button>
                    <button class="nav-btn" onclick="nextSlide()">Next â†’</button>
                </div>
                <div class="slide-counter">5 of 6</div>
            </div>

            <!-- Savings from Autoship Slide -->
            <div class="slide" id="slide-6">
                <h1 class="slide-title">ğŸ’° Savings from Autoship ğŸ’°</h1>
                <div class="slide-value" id="autoship-savings-value">$0.00</div>
                <p class="slide-description">Total Savings This Year</p>
                <p class="slide-description">You've saved big with autoship! Keep using it to save even more on your pet essentials. ğŸ‰</p>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="prevSlide()">â† Previous</button>
                    <button class="nav-btn" onclick="nextSlide()">Next â†’</button>
                </div>
                <div class="slide-counter">6 of 7</div>
            </div>

            <!-- Social Media Shareable Slide -->
            <div class="slide" id="slide-7">
                <h1 class="slide-title">ğŸ“± Share Your Chewy Journey ğŸ“±</h1>
                <div class="slide-value">ğŸ‰</div>
                <p class="slide-description">Share your Chewy experience with friends and family!</p>
                <p class="slide-description">Thank you for being part of the Chewy family. Your pets deserve the best! ğŸ¾</p>
                
                <!-- Social Media Icons -->
                <div class="social-media-icons">
                    <div class="social-icon facebook" onclick="shareToSocial('facebook')">
                        <i class="fab fa-facebook-f"></i>
                        <span class="social-label">Facebook</span>
                    </div>
                    <div class="social-icon snapchat" onclick="shareToSocial('snapchat')">
                        <i class="fab fa-snapchat-ghost"></i>
                        <span class="social-label">Snapchat</span>
                    </div>
                    <div class="social-icon instagram" onclick="shareToSocial('instagram')">
                        <i class="fab fa-instagram"></i>
                        <span class="social-label">Instagram</span>
                    </div>
                    <div class="social-icon whatsapp" onclick="shareToSocial('whatsapp')">
                        <i class="fab fa-whatsapp"></i>
                        <span class="social-label">WhatsApp</span>
                    </div>
                    <div class="social-icon message" onclick="shareToSocial('message')">
                        <i class="fas fa-comment"></i>
                        <span class="social-label">Message</span>
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="prevSlide()">â† Previous</button>
                    <button class="nav-btn" onclick="nextSlide()">Next â†’</button>
                </div>
                <div class="slide-counter">7 of 8</div>
            </div>

            <!-- Final Message Slide -->
            <div class="slide" id="slide-8">
                <h1 class="slide-title">ğŸ¯ Get Personalized Next Year ğŸ¯</h1>
                <div class="slide-value">ğŸ¾</div>
                <p class="slide-description">Create your pet profiles for a personalized playback next year!</p>
                <p class="slide-description">Add your pets' information to get a fully customized experience with personality badges, breed predictions, and personalized letters.</p>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="prevSlide()">â† Previous</button>
                    <button class="nav-btn" onclick="goHome()">Home</button>
                </div>
                <div class="slide-counter">8 of 8</div>
            </div>
        </div>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = 8; // Changed from 7 to 8 to include the final message slide
        let customerData = null;

        // Get customer data from Flask template
        window.addEventListener('load', () => {
            // Customer data is passed from Flask template
            customerData = JSON.parse('{{ customer_data | tojson | safe }}');
            populateSlides();
            showSlides();
        });

        function populateSlides() {
            if (!customerData) return;

            // Track which slides have data
            const slidesWithData = [];
            
            // Populate food fun fact slide (slide-1 in HTML)
            const foodFunFact = customerData.food_fun_fact || {};
            const totalFoodLbs = foodFunFact.total_food_lbs || 0;
            const funFacts = foodFunFact.fun_facts || [];
            const message = foodFunFact.message || `Your pets have consumed ${totalFoodLbs} lbs of food this year!`;
            
            // Check cuddliest month slide (slide-2 in HTML)
            const cuddliestMonth = customerData.cuddliest_month || '';
            const hasCuddliestMonth = cuddliestMonth && cuddliestMonth !== 'N/A' && cuddliestMonth.trim() !== '';
            
            if (totalFoodLbs > 0) {
                // Show food fun fact as landing page if there's food consumption data
                document.getElementById('food-fun-fact-value').textContent = `${totalFoodLbs} lbs`;
                document.getElementById('food-fun-fact-message').textContent = message;
                if (funFacts.length > 0) {
                    document.getElementById('food-fun-fact-details').textContent = funFacts[0];
                }
                slidesWithData.push(1);
                
                // Add cuddliest month after food fun fact if available
                if (hasCuddliestMonth) {
                    document.getElementById('cuddliest-month-value').textContent = cuddliestMonth;
                    slidesWithData.push(2);
                } else {
                    document.getElementById('slide-2').style.display = 'none';
                }
            } else {
                // Hide food fun fact slide if no food consumption data
                document.getElementById('slide-1').style.display = 'none';
                
                // Show cuddliest month as landing page if available
                if (hasCuddliestMonth) {
                    document.getElementById('cuddliest-month-value').textContent = cuddliestMonth;
                    slidesWithData.push(2);
                } else {
                    document.getElementById('slide-2').style.display = 'none';
                }
            }

            // Check donations slide (slide-3 in HTML)
            const donationsValue = customerData.amount_donated || 0;
            if (donationsValue > 0) {
                document.getElementById('donations-value').textContent = `$${donationsValue.toFixed(2)}`;
                slidesWithData.push(3);
            } else {
                document.getElementById('slide-3').style.display = 'none';
            }

            // Check milestone slide (slide-4 in HTML)
            const totalMonths = customerData.total_months || 0;
            if (totalMonths > 0) {
                document.getElementById('milestone-value').textContent = totalMonths;
                document.getElementById('milestone-text').textContent = totalMonths;
                slidesWithData.push(4);
            } else {
                document.getElementById('slide-4').style.display = 'none';
            }

            // Check most ordered slide (slide-5 in HTML)
            const mostOrdered = customerData.most_ordered || '';
            if (mostOrdered && mostOrdered !== 'No data available' && mostOrdered.trim() !== '') {
                document.getElementById('most-ordered-text').textContent = mostOrdered;
                slidesWithData.push(5);
            } else {
                document.getElementById('slide-5').style.display = 'none';
            }

            // Check autoship savings slide (slide-6 in HTML)
            const autoshipSavings = customerData.autoship_savings || 0;
            if (autoshipSavings > 0) {
                document.getElementById('autoship-savings-value').textContent = `$${autoshipSavings.toFixed(2)}`;
                slidesWithData.push(6);
            } else {
                document.getElementById('slide-6').style.display = 'none';
            }

            // Update total slides count and slide counters
            window.availableSlides = slidesWithData;
            window.totalSlides = slidesWithData.length + 2; // +2 for social media and final message slides
            
            console.log(`ğŸ“Š populateSlides() - availableSlides:`, slidesWithData);
            console.log(`ğŸ“Š populateSlides() - totalSlides:`, window.totalSlides);
            
            // Update slide counters for visible slides
            slidesWithData.forEach((slideNum, index) => {
                const counterElement = document.querySelector(`#slide-${slideNum} .slide-counter`);
                if (counterElement) {
                    counterElement.textContent = `${index + 1} of ${window.totalSlides}`;
                    console.log(`ğŸ“‹ Updated slide ${slideNum} counter to: ${index + 1} of ${window.totalSlides}`);
                }
            });
            
            // Update social media slide counter
            const socialMediaCounter = document.querySelector('#slide-7 .slide-counter');
            if (socialMediaCounter) {
                socialMediaCounter.textContent = `${slidesWithData.length + 1} of ${window.totalSlides}`;
                console.log(`ğŸ“± Updated social media slide counter to: ${slidesWithData.length + 1} of ${window.totalSlides}`);
            }
            
            // Update final message slide counter
            const finalMessageCounter = document.querySelector('#slide-8 .slide-counter');
            if (finalMessageCounter) {
                finalMessageCounter.textContent = `${slidesWithData.length + 2} of ${window.totalSlides}`;
                console.log(`ğŸ¯ Updated final message slide counter to: ${slidesWithData.length + 2} of ${window.totalSlides}`);
            }
        }

        function showSlides() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('slides-container').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'flex';
            document.getElementById('error-message').textContent = message;
        }

        function showSlide(slideNumber) {
            console.log(`ğŸ¯ showSlide(${slideNumber}) called`);
            
            // Hide all slides
            for (let i = 1; i <= 8; i++) {
                const slide = document.getElementById(`slide-${i}`);
                if (slide) {
                    slide.classList.remove('active');
                    console.log(`ğŸ“‹ Slide ${i} - display: ${slide.style.display}, classes: ${slide.className}`);
                }
            }
            
            // Show current slide
            const targetSlide = document.getElementById(`slide-${slideNumber}`);
            console.log(`ğŸ¯ Target slide ${slideNumber} - exists: ${!!targetSlide}, display: ${targetSlide ? targetSlide.style.display : 'N/A'}`);
            
            if (targetSlide && targetSlide.style.display !== 'none') {
                targetSlide.classList.add('active');
                currentSlide = slideNumber;
                console.log(`âœ… Successfully activated slide ${slideNumber}`);
            } else {
                console.log(`âŒ Failed to activate slide ${slideNumber} - slide not found or hidden`);
                if (targetSlide) {
                    console.log(`ğŸ” Slide ${slideNumber} exists but display is: ${targetSlide.style.display}`);
                }
            }
        }

        function nextSlide() {
            if (!window.availableSlides) return;
            
            console.log(`ğŸ”„ nextSlide() called - currentSlide: ${currentSlide}, availableSlides:`, window.availableSlides);
            
            // Check if current slide is in the available slides array
            const currentIndex = window.availableSlides.indexOf(currentSlide);
            
            if (currentIndex >= 0 && currentIndex < window.availableSlides.length - 1) {
                // Go to next available data slide
                const nextSlideNum = window.availableSlides[currentIndex + 1];
                console.log(`ğŸ“‹ Going to next available slide: ${nextSlideNum}`);
                showSlide(nextSlideNum);
            } else if (currentIndex === window.availableSlides.length - 1) {
                // Go from last data slide to social media slide
                console.log(`ğŸ“± Going from last data slide to social media slide (7)`);
                showSlide(7);
            } else if (currentSlide === 7) {
                // Go from social media slide to final message slide
                console.log(`ğŸ¯ Going from social media slide to final message slide (8)`);
                showSlide(8);
            } else if (currentSlide === 8) {
                // Already on final slide, do nothing
                console.log(`â¹ï¸ Already on final slide, staying put`);
                return;
            } else {
                // If we're not on a data slide, try to go to the first available slide
                if (window.availableSlides.length > 0) {
                    console.log(`ğŸ”„ Going to first available slide: ${window.availableSlides[0]}`);
                    showSlide(window.availableSlides[0]);
                }
            }
        }

        function prevSlide() {
            if (!window.availableSlides) return;
            
            if (currentSlide === 8) {
                // Go from final message slide to social media slide
                showSlide(7);
            } else if (currentSlide === 7) {
                // Go from social media slide to last available data slide
                const lastAvailableSlide = window.availableSlides[window.availableSlides.length - 1];
                showSlide(lastAvailableSlide);
            } else {
                const currentIndex = window.availableSlides.indexOf(currentSlide);
                if (currentIndex > 0) {
                    // Go to previous available slide
                    showSlide(window.availableSlides[currentIndex - 1]);
                } else if (currentSlide > 1) {
                    // Go to first slide
                    showSlide(1);
                }
            }
        }

        function goHome() {
            window.location.href = '/';
        }

        // Social Media Sharing Functions
        function shareToSocial(platform) {
            const customerId = '{{ customer_id }}';
            const shareUrl = `${window.location.origin}/experience/${customerId}`;
            const shareText = "Check out my Chewy pet experience! ğŸ¾";
            
            let shareLink = '';
            
            switch(platform) {
                case 'facebook':
                    shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`;
                    break;
                case 'instagram':
                    // Instagram doesn't support direct sharing via URL, so we'll copy to clipboard
                    copyToClipboard(`${shareText} ${shareUrl}`);
                    alert('Link copied to clipboard! You can now paste it in Instagram.');
                    return;
                case 'snapchat':
                    // Snapchat doesn't support direct sharing via URL, so we'll copy to clipboard
                    copyToClipboard(`${shareText} ${shareUrl}`);
                    alert('Link copied to clipboard! You can now paste it in Snapchat.');
                    return;
                case 'whatsapp':
                    shareLink = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
                    break;
                case 'message':
                    // For SMS sharing
                    if (navigator.share) {
                        navigator.share({
                            title: 'My Chewy Experience',
                            text: shareText,
                            url: shareUrl
                        });
                    } else {
                        shareLink = `sms:?body=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
                    }
                    break;
            }
            
            if (shareLink) {
                window.open(shareLink, '_blank', 'width=600,height=400');
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevSlide();
            }
        });
    </script>
</body>
</html> 